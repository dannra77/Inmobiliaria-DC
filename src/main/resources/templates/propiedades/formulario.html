<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Nueva Propiedad - Inmobiliaria DC</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            background-color: #1e1e1e;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 40px;
        }
        .form-container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #2c2c2c;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(167, 88, 88, 0.5);
        }
        label {
            font-weight: 600;
            color: #a75858;
        }
        input.form-control, textarea.form-control, select.form-control {
            background-color: #3b3b3b;
            border: 1px solid #a75858;
            color: white;
        }
        input.form-control:focus, textarea.form-control:focus, select.form-control:focus {
            background-color: #4a4a4a;
            border-color: #d07a7a;
            color: white;
            box-shadow: 0 0 8px rgba(208, 122, 122, 0.7);
        }
        .btn-primary {
            background-color: #a75858;
            border: none;
            padding: 10px 25px;
            font-weight: 600;
        }
        .btn-primary:hover {
            background-color: #d07a7a;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: #444444;
            border: none;
            color: white;
            padding: 10px 25px;
        }
        .btn-secondary:hover {
            background-color: #666666;
        }
        h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #f5f5f5;
            letter-spacing: 2px;
            user-select: none;
            border-bottom: 2px solid #a75858;
            padding-bottom: 10px;
        }
        fieldset {
            border: 1px solid #a75858;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            background-color: #363636;
        }
        legend {
            color: #a75858;
            font-weight: 700;
            padding: 0 15px;
            width: auto;
            font-size: 1.1em;
        }
        .form-section {
            margin-bottom: 30px;
        }
        .section-title {
            color: #d07a7a;
            font-size: 1.2em;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid #a75858;
        }
        .form-check-label {
            color: #ddd;
            font-weight: 500;
        }
        .form-check-input:checked {
            background-color: #a75858;
            border-color: #a75858;
        }
        .required::after {
            content: " *";
            color: #ff6b6b;
        }
        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        .characteristics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .price-input-group {
            position: relative;
        }
        .price-input-group::before {
            content: "$";
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #a75858;
            font-weight: bold;
            z-index: 10;
        }
        .price-input-group input {
            padding-left: 25px;
        }
        .optional-field {
            opacity: 0.8;
        }
    </style>
</head>
<body>
<div class="form-container">
    <h2>üè† Registrar Nueva Propiedad</h2>

    <!-- Mensajes -->
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>

    <form th:action="@{/propiedades/guardar}" th:object="${propiedad}" method="post" novalidate id="propiedadForm">

        <!-- ID oculto para edici√≥n -->
        <input type="hidden" th:field="*{id}" />

        <!-- Secci√≥n 1: Informaci√≥n B√°sica y Propietario -->
        <div class="form-section">
            <h4 class="section-title">üìã Informaci√≥n B√°sica</h4>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="tipo" class="form-label required">Tipo de Propiedad</label>
                    <select id="tipo" th:field="*{tipo}" class="form-control" required>
                        <option value="" disabled selected>Seleccione el tipo</option>
                        <option value="Casa">Casa</option>
                        <option value="Departamento">Departamento</option>
                        <option value="PH">PH</option>
                        <option value="Oficina">Oficina</option>
                        <option value="Local">Local Comercial</option>
                        <option value="Terreno">Terreno</option>
                        <option value="Cochera">Cochera</option>
                        <option value="Galp√≥n">Galp√≥n</option>
                    </select>
                    <div class="invalid-feedback">Por favor seleccione el tipo de propiedad</div>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="propietario" class="form-label required">Propietario</label>
                    <select id="propietario" th:field="*{propietario.id}" class="form-control" required>
                        <option value="">Seleccione un propietario</option>
                        <option th:each="persona : ${personas}"
                                th:value="${persona.id}"
                                th:text="${persona.nombre + ' ' + persona.apellido + ' - DNI: ' + persona.dni}">
                        </option>
                    </select>
                    <div class="invalid-feedback">Por favor seleccione un propietario</div>
                    <small class="form-text text-muted">Si el propietario no est√° en la lista, <a th:href="@{/personas/nuevo}" class="text-warning">agregue una persona primero</a></small>
                </div>
            </div>

            <div class="mb-3">
                <label for="titulo" class="form-label required">T√≠tulo de la Propiedad</label>
                <input type="text" id="titulo" th:field="*{titulo}" class="form-control"
                       placeholder="Ingrese el t√≠tulo de la propiedad" required maxlength="100" />
                <div class="invalid-feedback">Por favor ingrese el t√≠tulo de la propiedad</div>
            </div>

            <div class="mb-3 optional-field">
                <label for="descripcion" class="form-label">Descripci√≥n</label>
                <textarea id="descripcion" th:field="*{descripcion}" class="form-control" rows="4"
                          placeholder="Sin descripci√≥n..."
                          maxlength="500"></textarea>
            </div>
        </div>

        <!-- Secci√≥n 2: Ubicaci√≥n -->
        <div class="form-section">
            <h4 class="section-title">üìç Ubicaci√≥n</h4>

            <div class="mb-3">
                <label for="direccion" class="form-label required">Direcci√≥n</label>
                <input type="text" id="direccion" th:field="*{direccion}" class="form-control"
                       placeholder="Ingrese la direcci√≥n" required />
                <div class="invalid-feedback">Por favor ingrese la direcci√≥n</div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="localidad" class="form-label required">Localidad</label>
                    <input type="text" id="localidad" th:field="*{localidad}" class="form-control"
                           placeholder="Ingrese la localidad" required />
                    <div class="invalid-feedback">Por favor ingrese la localidad</div>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="provincia" class="form-label required">Provincia</label>
                    <input type="text" id="provincia" th:field="*{provincia}" class="form-control"
                           placeholder="Ingrese la provincia" required />
                    <div class="invalid-feedback">Por favor ingrese la provincia</div>
                </div>
                <div class="col-md-4 mb-3 optional-field">
                    <label for="codigoPostal" class="form-label">C√≥digo Postal</label>
                    <input type="text" id="codigoPostal" th:field="*{codigoPostal}" class="form-control"
                           placeholder="No especificado" maxlength="10" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3 optional-field">
                    <label for="pais" class="form-label">Pa√≠s</label>
                    <input type="text" id="pais" th:field="*{pais}" class="form-control"
                           placeholder="No especificado" />
                </div>
                <div class="col-md-3 mb-3 optional-field">
                    <label for="latitud" class="form-label">Latitud</label>
                    <input type="number" id="latitud" step="0.000001" th:field="*{latitud}"
                           class="form-control" placeholder="No especificada" />
                </div>
                <div class="col-md-3 mb-3 optional-field">
                    <label for="longitud" class="form-label">Longitud</label>
                    <input type="number" id="longitud" step="0.000001" th:field="*{longitud}"
                           class="form-control" placeholder="No especificada" />
                </div>
            </div>
        </div>

        <!-- Secci√≥n 3: Caracter√≠sticas F√≠sicas -->
        <div class="form-section">
            <h4 class="section-title">üìê Caracter√≠sticas F√≠sicas</h4>

            <div class="row">
                <div class="col-md-4 mb-3 optional-field">
                    <label for="superficieTotal" class="form-label">Superficie Total (m¬≤)</label>
                    <input type="number" id="superficieTotal" step="0.01" min="0"
                           th:field="*{superficieTotal}" class="form-control" placeholder="0" />
                </div>
                <div class="col-md-4 mb-3 optional-field">
                    <label for="superficieCubierta" class="form-label">Superficie Cubierta (m¬≤)</label>
                    <input type="number" id="superficieCubierta" step="0.01" min="0"
                           th:field="*{superficieCubierta}" class="form-control" placeholder="0" />
                </div>
                <div class="col-md-4 mb-3 optional-field">
                    <label for="antiguedad" class="form-label">Antig√ºedad (a√±os)</label>
                    <input type="number" id="antiguedad" min="0" th:field="*{antiguedad}"
                           class="form-control" placeholder="0" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-3 optional-field">
                    <label for="ambientes" class="form-label">Ambientes</label>
                    <input type="number" id="ambientes" min="0" th:field="*{ambientes}"
                           class="form-control" placeholder="0" />
                </div>
                <div class="col-md-4 mb-3 optional-field">
                    <label for="dormitorios" class="form-label">Dormitorios</label>
                    <input type="number" id="dormitorios" min="0" th:field="*{dormitorios}"
                           class="form-control" placeholder="0" />
                </div>
                <div class="col-md-4 mb-3 optional-field">
                    <label for="banios" class="form-label">Ba√±os</label>
                    <input type="number" id="banios" min="0" th:field="*{banios}"
                           class="form-control" placeholder="0" />
                </div>
            </div>
        </div>

        <!-- Secci√≥n 4: Comodidades -->
        <fieldset>
            <legend>üèä Comodidades y Caracter√≠sticas</legend>
            <div class="characteristics-grid">
                <div class="form-check">
                    <input type="checkbox" id="cochera" th:field="*{cochera}" class="form-check-input" />
                    <label class="form-check-label" for="cochera">üöó Cochera/Garaje</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" id="patio" th:field="*{patio}" class="form-check-input" />
                    <label class="form-check-label" for="patio">üå≥ Patio</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" id="jardin" th:field="*{jardin}" class="form-check-input" />
                    <label class="form-check-label" for="jardin">üå∑ Jard√≠n</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" id="pileta" th:field="*{pileta}" class="form-check-input" />
                    <label class="form-check-label" for="pileta">üèä Pileta</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" id="terraza" th:field="*{terraza}" class="form-check-input" />
                    <label class="form-check-label" for="terraza">üåá Terraza</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" id="amoblado" th:field="*{amoblado}" class="form-check-input" />
                    <label class="form-check-label" for="amoblado">üõãÔ∏è Amoblado</label>
                </div>
            </div>
        </fieldset>

        <!-- Secci√≥n 5: Precios -->
        <div class="form-section">
            <h4 class="section-title">üí∞ Precios</h4>

            <div class="row">
                <div class="col-md-6 mb-3 optional-field">
                    <label for="precioVenta" class="form-label">Precio de Venta</label>
                    <div class="price-input-group">
                        <input type="number" id="precioVenta" step="0.01" min="0"
                               th:field="*{precioVenta}" class="form-control" placeholder="0.00" />
                    </div>
                </div>
                <div class="col-md-6 mb-3 optional-field">
                    <label for="precioAlquiler" class="form-label">Precio de Alquiler</label>
                    <div class="price-input-group">
                        <input type="number" id="precioAlquiler" step="0.01" min="0"
                               th:field="*{precioAlquiler}" class="form-control" placeholder="0.00" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n 6: Estado y Disponibilidad -->
        <fieldset>
            <legend>üìä Estado y Disponibilidad</legend>
            <div class="row">
                <div class="col-md-4">
                    <div class="form-check mb-3">
                        <input type="checkbox" id="enVenta" th:field="*{enVenta}" class="form-check-input" />
                        <label class="form-check-label" for="enVenta">üè∑Ô∏è En Venta</label>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-check mb-3">
                        <input type="checkbox" id="enAlquiler" th:field="*{enAlquiler}" class="form-check-input" />
                        <label class="form-check-label" for="enAlquiler">üîë En Alquiler</label>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-check mb-3">
                        <input type="checkbox" id="reservado" th:field="*{reservado}" class="form-check-input" />
                        <label class="form-check-label" for="reservado">‚è≥ Reservado</label>
                    </div>
                </div>
            </div>

            <div class="mb-3 optional-field">
                <label for="estado" class="form-label">Estado Actual</label>
                <select id="estado" th:field="*{estado}" class="form-control">
                    <option value="">Seleccione estado</option>
                    <option value="Disponible">‚úÖ Disponible</option>
                    <option value="En Negociaci√≥n">ü§ù En Negociaci√≥n</option>
                    <option value="Vendida">üí∞ Vendida</option>
                    <option value="Alquilada">üè† Alquilada</option>
                    <option value="En Refacciones">üî® En Refacciones</option>
                    <option value="No Disponible">‚ùå No Disponible</option>
                </select>
            </div>
        </fieldset>

        <!-- Secci√≥n 7: Informaci√≥n Adicional -->
        <div class="form-section">
            <h4 class="section-title">üìù Informaci√≥n Adicional</h4>

            <div class="mb-3 optional-field">
                <label for="observaciones" class="form-label">Observaciones</label>
                <textarea id="observaciones" th:field="*{observaciones}" class="form-control" rows="3"
                          placeholder="Sin observaciones..."></textarea>
            </div>

            <div class="mb-3 optional-field">
                <label for="imagenes" class="form-label">Im√°genes (URLs)</label>
                <input type="text" id="imagenes" th:field="*{imagenes}" class="form-control"
                       placeholder="No especificado" />
                <small class="form-text text-muted">Separar m√∫ltiples URLs con comas</small>
            </div>
        </div>

        <!-- Botones -->
        <div class="btn-group">
            <button type="submit" class="btn btn-primary">
                <span th:if="${propiedad.id == null}">üíæ Guardar Propiedad</span>
                <span th:if="${propiedad.id != null}">‚úèÔ∏è Actualizar Propiedad</span>
            </button>
            <a th:href="@{/propiedades/listar}" class="btn btn-secondary">‚ùå Cancelar</a>
            <a th:if="${propiedad.id != null}" th:href="@{/propiedades/ver/} + ${propiedad.id}" class="btn btn-info">üëÅÔ∏è Ver Detalles</a>
        </div>
    </form>
</div>

<!-- Validaci√≥n JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('propiedadForm');

        form.addEventListener('submit', function(e) {
            // Solo validar campos obligatorios
            let isValid = true;
            const requiredFields = [
                document.getElementById('tipo'),
                document.getElementById('propietario'),
                document.getElementById('titulo'),
                document.getElementById('direccion'),
                document.getElementById('localidad'),
                document.getElementById('provincia')
            ];

            // Remover clases de error previas
            requiredFields.forEach(field => {
                if (field) {
                    field.classList.remove('is-invalid');
                }
            });

            // Validar campos requeridos
            requiredFields.forEach(field => {
                if (field && !field.value.trim()) {
                    isValid = false;
                    field.classList.add('is-invalid');
                }
            });

            if (!isValid) {
                e.preventDefault();
                alert('Por favor, complete los campos obligatorios marcados con *');
                return;
            }

            // Autocompletar campos vac√≠os antes de enviar
            autocompletarCamposVacios();
        });

        function autocompletarCamposVacios() {
            const camposOpcionales = {
                'descripcion': 'Sin descripci√≥n',
                'codigoPostal': 'No especificado',
                'pais': 'No especificado',
                'observaciones': 'Sin observaciones',
                'imagenes': 'No especificado',
                'estado': 'Disponible'
            };

            // Autocompletar campos de texto
            for (const [campoId, valorDefault] of Object.entries(camposOpcionales)) {
                const campo = document.getElementById(campoId);
                if (campo && !campo.value.trim()) {
                    campo.value = valorDefault;
                }
            }

            // Autocompletar campos num√©ricos con 0
            const camposNumericos = [
                'superficieTotal', 'superficieCubierta', 'antiguedad',
                'ambientes', 'dormitorios', 'banios',
                'precioVenta', 'precioAlquiler'
            ];

            camposNumericos.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo && (!campo.value || campo.value === '')) {
                    campo.value = '0';
                }
            });

            // Para latitud y longitud, si est√°n vac√≠os no hacemos nada (pueden ser null)
            const latitud = document.getElementById('latitud');
            const longitud = document.getElementById('longitud');
            if (latitud && !latitud.value) {
                // No autocompletamos coordenadas
            }
            if (longitud && !longitud.value) {
                // No autocompletamos coordenadas
            }
        }

        // Auto-formato para precios
        const precioVenta = document.getElementById('precioVenta');
        const precioAlquiler = document.getElementById('precioAlquiler');

        [precioVenta, precioAlquiler].forEach(input => {
            if (input) {
                input.addEventListener('blur', function() {
                    if (this.value && this.value !== '0') {
                        this.value = parseFloat(this.value).toFixed(2);
                    }
                });
            }
        });
    });
</script>
</body>
</html>